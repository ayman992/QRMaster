<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code App</title>
  <style>
    body {font-family: Arial, sans-serif; margin:0; padding:0; background:#121212; color:#fff; text-align:center;}
    header {padding:1rem; background:#1e1e1e; font-size:1.4rem; font-weight:bold;}
    main {padding:1rem;}
    select, input, button {margin:0.5rem; padding:0.7rem; border-radius:8px; border:none; font-size:1rem;}
    input, select {width:80%;}
    button {background:#6200ea; color:#fff; cursor:pointer;}
    button:hover {background:#3700b3;}
    canvas {margin-top:1rem; background:#fff; padding:10px; border-radius:12px;}
    .actions {margin-top:1rem;}
    .actions button {margin:0.3rem;}
    #result {margin-top:1rem; font-size:0.9rem;}
  </style>
</head>
<body>
  <header>QR Code Generator & Scanner</header>
  <main>
    <h2>Generate QR Code</h2>
    <select id="qrType">
      <option value="text">Text</option>
      <option value="url">URL</option>
      <option value="phone">Phone</option>
      <option value="email">Email</option>
      <option value="facebook">Facebook</option>
      <option value="instagram">Instagram</option>
      <option value="youtube">YouTube</option>
      <option value="snapchat">Snapchat</option>
      <option value="twitter">X (Twitter)</option>
      <option value="tiktok">TikTok</option>
    </select>
    <br>
    <input type="text" id="qrInput" placeholder="Enter your text or username">
    <br>
    <button onclick="generateQR()">Generate</button>
    <div id="qrcode"></div>
    <div class="actions">
      <button onclick="openQR()">Open QR</button>
      <button onclick="shareQR()">Share / Copy</button>
      <button onclick="copyQRImage()">Copy QR Image</button>
    </div>

    <h2>Scan QR Code</h2>
    <video id="preview" width="250" height="200" style="border:1px solid #555; border-radius:8px;"></video>
    <div id="result"></div>
  </main>

  <!-- QR Code library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- jsQR for scanning -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsqr/1.4.0/jsQR.min.js"></script>

  <script>
    let qrCode;
    function generateQR() {
      const type = document.getElementById("qrType").value;
      let input = document.getElementById("qrInput").value.trim();
      if (!input) { alert("Please enter a value"); return; }
      let value = "";
      switch(type) {
        case "text": value = input; break;
        case "url": value = input.startsWith("http") ? input : "https://" + input; break;
        case "phone": value = "tel:" + input; break;
        case "email": value = "mailto:" + input; break;
        case "facebook": value = "https://facebook.com/" + input; break;
        case "instagram": value = "https://instagram.com/" + input; break;
        case "youtube": value = "https://youtube.com/@" + input; break;
        case "snapchat": value = "https://snapchat.com/add/" + input; break;
        case "twitter": value = "https://x.com/" + input; break;
        case "tiktok": value = "https://tiktok.com/@" + input; break;
      }
      document.getElementById("qrcode").innerHTML = "";
      qrCode = new QRCode(document.getElementById("qrcode"), {
        text: value, width: 200, height: 200
      });
      qrCode._value = value; // save for sharing
    }

    function openQR() {
      if (!qrCode) { alert("Generate a QR first!"); return; }
      const img = document.querySelector("#qrcode img") || document.querySelector("#qrcode canvas");
      if (img) {
        const dataUrl = img.src || img.toDataURL();
        window.open(dataUrl, "_blank");
      }
    }

    function shareQR() {
      if (!qrCode) { alert("Generate a QR first!"); return; }
      const value = qrCode._value;
      if (navigator.share) {
        navigator.share({title:"QR Code", text:"Here is my QR Code", url:value})
          .catch(err => console.log("Share canceled", err));
      } else {
        navigator.clipboard.writeText(value).then(() => {
          alert("Link copied: " + value);
        });
      }
    }

    async function copyQRImage() {
      if (!qrCode) { alert("Generate a QR first!"); return; }
      const canvas = document.querySelector("#qrcode canvas");
      if (!canvas) { alert("QR not ready"); return; }
      canvas.toBlob(async blob => {
        try {
          await navigator.clipboard.write([new ClipboardItem({'image/png': blob})]);
          alert("QR image copied to clipboard!");
        } catch (err) {
          alert("Copy image not supported on this device/browser.");
        }
      });
    }

    // QR Scanner
    const video = document.getElementById("preview");
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(stream => { video.srcObject = stream; video.setAttribute("playsinline", true); video.play(); requestAnimationFrame(tick); });

    function tick() {
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        canvas.height = video.videoHeight;
        canvas.width = video.videoWidth;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, canvas.width, canvas.height);
        if (code) {
          document.getElementById("result").innerText = "Scanned: " + code.data;
        }
      }
      requestAnimationFrame(tick);
    }
  </script>
</body>
</html>
